<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ruoyi.system.mapper.SysCourseMapper">

	<resultMap type="SysCourse" id="SysCourseResult">
		<id     property="courseId"   column="course_id"    />
		<result property="courseName" column="course_name"  />
		<result property="orderNum"   column="order_num"    />
		<result property="credit"     column="credit"       />
		<result property="hour"       column="hour"       	/>
		<result property="status"     column="status"       />
		<result property="delFlag"    column="del_flag"     />
		<result property="createBy"   column="create_by"    />
		<result property="createTime" column="create_time"  />
		<result property="updateBy"   column="update_by"    />
		<result property="updateTime" column="update_time"  />
	</resultMap>
	
	<sql id="selectCourseVo">
        select c.course_id, c.course_name, c.order_num, c.credit, c.hour, c.status, c.del_flag, c.create_by, c.create_time
        from sys_course c
    </sql>

<!--	* 查询课程数据-->
	<select id="selectCourseList" parameterType="SysCourse" resultMap="SysCourseResult">
        <include refid="selectCourseVo"/>
        where c.del_flag = '0'
		<if test="courseId != null and courseId != 0">
			AND course_id = #{courseId}
		</if>
		<if test="courseName != null and courseName != ''">
			AND course_name like concat('%', #{courseName}, '%')
		</if>
		<if test="status != null and status != ''">
			AND status = #{status}
		</if>
		<!-- 数据范围过滤 -->
-- 		${params.dataScope}
		order by c.order_num
    </select>

	<select id="selectCourseListByUserId" resultMap="SysCourseResult">
		<include refid="selectCourseVo"/>
		where user_id = #{userId} and c.del_flag = '0'
	</select>
    
    <select id="selectCourseById" parameterType="Long" resultMap="SysCourseResult">
		<include refid="selectCourseVo"/>
		where c.course_id = #{courseId}
	</select>

	<!--	* 查询课程是否存在选课学生-->
    <select id="checkCourseExistStu" parameterType="Long" resultType="int">
		select count(1) from sys_take_course where course_id = 1001
		and user_id in (select user_id from sys_user_post where post_id = 4)
	</select>

	<!--	* 查询课程是否存在任课教师-->
	<select id="checkCourseExistTea" parameterType="Long" resultType="int">
		select count(1) from sys_take_course where course_id = 1001
		and user_id in (select user_id from sys_user_post where post_id = 3)
	</select>

	<!--	* 校验课程名称是否唯一-->
	<select id="checkCourseNameUnique" resultMap="SysCourseResult">
	    <include refid="selectCourseVo"/>
		where course_name=#{courseName} and del_flag = '0' limit 1
	</select>

	<insert id="insertCourse" parameterType="SysCourse">
 		insert into sys_course(
 			<if test="courseId != null and courseId != 0">course_id,</if>
 			<if test="courseName != null and courseName != ''">course_name,</if>
 			<if test="orderNum != null">order_num,</if>
 			<if test="credit != null">credit,</if>
 			<if test="hour != null">hour,</if>
 			<if test="status != null">status,</if>
 			<if test="createBy != null and createBy != ''">create_by,</if>
 			create_time
 		)values(
			<if test="courseId != null and courseId != 0">#{courseId},</if>
			<if test="courseName != null and courseName != ''">#{courseName},</if>
			<if test="orderNum != null">#{orderNum},</if>
			<if test="credit != null">#{credit},</if>
			<if test="hour != null">#{hour},</if>
			<if test="status != null">#{status},</if>
 			<if test="createBy != null and createBy != ''">#{createBy},</if>
 			sysdate()
 		)
	</insert>

	<update id="updateCourse" parameterType="SysCourse">
		update sys_course
		<set>
			<if test="courseName != null and courseName != ''">course_name = #{courseName},</if>
			<if test="orderNum != null">order_num = #{orderNum},</if>
			<if test="credit != null">credit = #{credit},</if>
			<if test="hour != null">hour = #{hour},</if>
			<if test="status != null and status != ''">status = #{status},</if>
			<if test="updateBy != null and updateBy != ''">update_by = #{updateBy},</if>
			update_time = sysdate()
		</set>
		where course_id = #{courseId}
	</update>
	 
	<update id="updateCourseStatusNormal" parameterType="Long">
 	    update sys_course set status = '0' where course_id in
 	    <foreach collection="array" item="courseId" open="(" separator="," close=")">
        	#{courseId}
        </foreach>
	</update>
	
	<delete id="deleteCourseById" parameterType="Long">
		update sys_course set del_flag = '2' where course_id = #{courseId}
	</delete>

</mapper> 